BEGIN:VCALENDAR
PRODID:-//hugo-{{ hugo.Version }}//Calendar//EN
VERSION:2.0
CALSCALE:GREGORIAN
{{ partial "ics-tzid.html" -}}
METHOD:PUBLISH
{{ $today := now | dateFormat "2006" -}}
{{ $scratch := newScratch }}
{{ range .Pages -}}
{{ if ge (.Date.Format "2006") $today -}}
{{ $scratch.Set "uid" "" }}
{{ with .Permalink }}{{ $scratch.Add "uid" . }}{{ end }}
{{ with .Date }}{{ $scratch.Add "uid" ( . | printf "%s" ) }}{{ end }}
{{ with .Params.endTime }}{{ $scratch.Add "uid" ( . | printf "%s" ) }}{{ end }}
{{ with .Params.Status }}{{ $scratch.Add "uid" . }}{{ end }}
BEGIN:VEVENT
UID:{{ $scratch.Get "uid" | md5 }}@{{ .Site.BaseURL | replaceRE "^https?://([^/]+).*" "$1" }}
CREATED:{{ with .Params.created -}}{{ . | dateFormat "20060102T150405\n" }}{{ else -}}{{ with .PublishDate -}}{{ . | dateFormat "20060102T150405\n" }}{{ else -}}.Date.Format "20060102T150405\n" }}{{ end -}}{{ end -}}
DTSTAMP:{{ .PublishDate.Format "20060102T150405" }}
DTSTART;TZID=America/Chicago;VALUE=DATE-TIME:{{ .Date.Format "20060102T150405" }}
{{ with .Params.endTime -}}DTEND;TZID=America/Chicago;VALUE=DATE-TIME:{{ . | dateFormat "20060102T150405\n" }}{{ end -}}
SUMMARY;ENCODING=QUOTED-PRINTABLE:{{ if in .Site.Params.status .Params.status }}{{ upper .Params.status }} - {{ end }}{{ .Title }}
{{ with .Params.location -}}LOCATION;ENCODING=QUOTED-PRINTABLE:{{ . | replaceRE "\\(.*\\)" "" | replaceRE "[\\[\\]]" "" | printf "%s\n" }}{{ end -}}
URL:{{ .Permalink }}
END:VEVENT
{{ end -}}
{{ end -}}
END:VCALENDAR
